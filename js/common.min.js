/* 20140713 */
Switchboard=function(){"use strict";return{version:20140630,parsers:{},templates:{},event:{list:[],add:function(a,b,c,d){d=d||!1,a.addEventListener?a.addEventListener(b,c,d):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c,Switchboard.event.list.push([a,b,c])},remove:function(a,b,c,d){d=d||!1;var e=0;for(a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null,e;e<Switchboard.event.list.length;e+=1)if(Switchboard.event.list[e]&&Switchboard.event.list[e]&&Switchboard.event.list[e][0]===a&&Switchboard.event.list[e][1]===b&&Switchboard.event.list[e][2]===c){Switchboard.event.list.splice(e,1);break}},removeAll:function(a){a=a||document;var b=Switchboard.event.list.length-1;for(b;b>=0;b-=1)Switchboard.event.list[b]&&(!Switchboard.event.list[b]||Switchboard.event.list[b][0]!==a&&a!==document||Switchboard.event.remove(Switchboard.event.list[b][0],Switchboard.event.list[b][1],Switchboard.event.list[b][2]))}},getTarget:function(a){return a=a||window.event,a.target?a.target:a.srcElement},hasAttribute:function(a,b,c){return a[b]?a[b].match(new RegExp("(\\s|^)"+c+"(\\s|$)")):void 0},hasClass:function(a,b){return Switchboard.hasAttribute(a,"className",b)},addClass:function(a,b){Switchboard.hasClass(a,b)||(a.className=Switchboard.trim(a.className+" "+b))},removeClass:function(a,b){Switchboard.hasClass(a,b)&&(a.className=a.className.replace(new RegExp("(\\s|^)"+b+"(\\s|$)")," "),a.className=Switchboard.trim(a.className))},toggleClass:function(a,b){Switchboard.hasClass(a,b)?Switchboard.removeClass(a,b):Switchboard.addClass(a,b)},getElementsByClassName:function(a,b,c){var d=[],e=[],f=0,g=0;if(b=b||document,c=c.toLowerCase()||"*","*"===c&&document.getElementsByClassName)return b.getElementsByClassName(a);if(b.getElementsByClassName)if(e=b.getElementsByClassName(a),c&&e.length)for(f in e)e[f].tagName&&e[f].tagName.toLowerCase()===c&&(d[g]=e[f],g+=1);else d=e;else{e=b.getElementsByTagName(c);for(f in e)Switchboard.hasClass(e[f],a)&&(d[g]=e[f],g+=1)}return d},getText:function(a){return a.textContent?a.textContent:a.innerText?a.innerText:a.text?a.text:a.innerHTML},putText:function(a,b){a.textContent?a.textContent=b:a.innerText?a.innerText=b:a.text?a.text=b:a.innerHTML=b},trim:function(a){return a=a||"",a.toString().replace(/^\s\s*/,"").replace(/\s\s*$/,"")},decode:function(json){var reply="";return reply="object"==typeof JSON?JSON.parse(json):eval("("+json+")")},log:function(a){"object"==typeof console&&"function"==typeof console.log&&console.log(a)},ajax:{request:function(a){a.method=a.method||"GET",a.onStart=a.onStart||function(){},a.onComplete=a.onComplete||function(){};var b,c,d="?";if(c=function(){switch(a.onStart(),typeof a.onComplete){case"object":a.onComplete.value?a.onComplete.value=a.response:a.onComplete.childNodes[0]&&Switchboard.putText(a.onComplete,a.response);break;case"function":a.onComplete()}},window.XMLHttpRequest)b=new XMLHttpRequest;else{if(!window.ActiveXObject)return!1;b=new ActiveXObject("Microsoft.XMLHTTP")}"GET"===a.method&&((-1!==a.path.indexOf("?")||-1!==a.param.indexOf("?"))&&(d="&"),a.path=a.path+d+a.param,a.param=""),b.open(a.method.toUpperCase(),a.path,!0),"POST"===a.method&&b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b.setRequestHeader("rest","true"),Switchboard.event.add(b,"readystatechange",function(){if(4===b.readyState){if(200!==b.status)return!1;a.response=b.responseText,c()}}),b.send(a.param)}},init:function(){{var a,b,c,d,e,f,g,h=Switchboard.getElementsByClassName("header",document.body,"div")[0],i=Switchboard.getElementsByClassName("body",document.body,"div")[0];Switchboard.getElementsByClassName("text-form",i,"form")}e=function(a){var c,d,e,f=document.getElementById(a.deviceId),g=Switchboard.parsers[a.typeClass],h=a.value,i=a.state;Switchboard.log(a.deviceId+" updated"),f&&(d=b[a.typeClass].markup,c=Switchboard.hasClass(f,"selected")?" selected":"",e=f.outerHTML,g&&(d=g(a.deviceId,d,i,h,b[a.typeClass].fragments)),f&&d&&a&&(d=d.split("{{DEVICE_ID}}").join(a.deviceId),d=d.split("{{DEVICE_TYPE}}").join(a.typeClass),d=d.split("{{DEVICE_SELECTED}}").join(c),d=d.split("{{LAZY_LOAD_IMAGE}}").join(c?"src":"data-src")),d!==e&&(f.outerHTML=d))},c=function(){document.getElementById("indicator")||(f=document.createElement("span"),f.id="indicator",Switchboard.addClass(f,"connecting"),Switchboard.putText(f,"Connecting"),h.appendChild(f)),Switchboard.log("Connecting to WebSocket"),g=new WebSocket("ws://"+window.location.host,"echo-protocol"),Switchboard.event.add(g,"open",function(){f.className="connected",Switchboard.putText(f,"Connected")}),Switchboard.event.add(g,"close",function(){f.className="disconnected",Switchboard.putText(f,"Disconnected")}),Switchboard.event.add(g,"message",function(){var a=Switchboard.decode(event.data);"string"==typeof a.deviceId?e(a):"object"==typeof a&&(b=a)})},d=function(){var a=f&&Switchboard.hasClass(f,"connected");return a||c(),a},"function"==typeof WebSocket||"object"==typeof WebSocket?c():(Switchboard.log("WebSockets not supported - using polling"),function(){var a;a={path:"/templates/",param:"ts="+(new Date).getTime(),method:"GET",onComplete:function(){b=Switchboard.decode(a.response)}},Switchboard.ajax.request(a),setInterval(function(){var a={path:"/state/",param:"ts="+(new Date).getTime(),method:"GET",onComplete:function(){var b,c=Switchboard.decode(a.response);for(b in c)e(c[b])}};Switchboard.ajax.request(a)},1e4)}()),a=function(a){var b,c,d=0;if(document.getElementById(a))for(b=document.getElementById(a),c=b.getElementsByTagName("img"),d=0;d<c.length;d+=1)c[d].getAttribute("data-src")&&!c[d].src&&(c[d].src=c[d].getAttribute("data-src"))},a(document.body.className),Switchboard.event.add(h,"click",function(b){var d=Switchboard.getTarget(b).parentNode,e=d.tagName.toLowerCase(),f=document.getElementById(d.className),g=Switchboard.getElementsByClassName("selected",h,"li")[0],j=Switchboard.getElementsByClassName("selected",i,"div")[0];"li"===e?(b.preventDefault(),d!==g&&(Switchboard.removeClass(g,"selected"),Switchboard.removeClass(j,"selected"),Switchboard.addClass(d,"selected"),Switchboard.addClass(f,"selected"),a(d.className.replace(" selected","")))):"indicator"===Switchboard.getTarget(b).id&&Switchboard.hasClass(Switchboard.getTarget(b),"disconnected")&&c()}),Switchboard.event.add(i,"click",function(a){var b,c=Switchboard.getTarget(a),e=c.tagName.toLowerCase(),f="",h=(new Date).getTime();c="img"===e?c.parentNode:c,c="i"===e?c.parentNode:c,c="span"===e?c.parentNode:c,"a"===c.tagName.toLowerCase()&&"external"!=c.rel&&(a.preventDefault(),f=c.href,g?d()&&g.send(c.href):(b={path:f,param:"ts="+h,method:"GET",onComplete:function(){Switchboard.log(b.response)}},Switchboard.ajax.request(b)))}),Switchboard.event.add(i,"submit",function(a){var b,c,e=Switchboard.getTarget(a),f=((new Date).getTime(),"");a.preventDefault(),f=Switchboard.getElementsByClassName("text-input",e,"input")[0].value,b=Switchboard.getElementsByClassName("text-input",e,"input")[0].name,g?d()&&g.send("/?"+b+"=text-"+f):(c={path:"/",param:b+"="+f,method:"POST",onComplete:function(){Switchboard.log(c.response)}},Switchboard.ajax.request(c))}),Switchboard.addClass(document.body,"rich"),"function"==typeof init&&init()}}}(),document.addEventListener&&document.addEventListener("DOMContentLoaded",Switchboard.init,!1),Switchboard.event.add(window,"load",function(){"use strict";document.addEventListener||Switchboard.init()}),Switchboard.event.add(window,"unload",function(){"use strict";Switchboard.event.removeAll()}),function(a){"use strict";a.foscam=function(a,b,c,d){var e="",f="";return"on"===d?e=" device-active":"off"===d&&(f=" device-active"),b=b.replace("{{DEVICE_STATE_ON}}",e),b=b.replace("{{DEVICE_STATE_OFF}}",f),"object"==typeof Switchboard&&(b=b.split("{{LAZY_LOAD_IMAGE}}").join(Switchboard.hasClass(Switchboard.getElementsByClassName("selected",null,"li")[0],a)?"src":"data-src")),b}}("undefined"==typeof exports?this.Switchboard.parsers:exports),function(a){"use strict";a.ps3=function(a,b,c){var d="";return"ok"===c?d=" device-on":"err"===c&&(d=" device-off"),b.replace("{{DEVICE_STATE}}",d)}}("undefined"==typeof exports?this.Switchboard.parsers:exports),function(a){"use strict";a.roku=function(a,b,c,d,e){var f=e.list,g=0,h="";if(d)for(g in d)h+=f.split("{{APP_ID}}").join(d[g].id),h=h.split("{{APP_IMG}}").join(d[g].cache),h=h.split("{{APP_NAME}}").join(d[g].name);return b.replace("{{ROKU_DYNAMIC}}",h)}}("undefined"==typeof exports?this.Switchboard.parsers:exports),function(a){"use strict";a.samsung=function(a,b,c){var d="";return"ok"===c?d=" device-on":"err"===c&&(d=" device-off"),b.replace("{{DEVICE_STATE}}",d)}}("undefined"==typeof exports?this.Switchboard.parsers:exports),function(a){"use strict";a.smartthings=function(a,b,c,d,e){var f,g,h=e.switch,i=e.lock,j=e.contact,k=e.water,l=e.motion,m=e.group,n=0,o=0,p="",q="",r="",s="",t=function(a,b){var c={},d=[],e=0,f=0;for(e in b)c=b[e],c.label===a&&(d[f]=c,f+=1);return d},u=function(a){var b="",c="",d="";switch(a.type){case"switch":b=h;break;case"lock":b=i;break;case"contact":b=j;break;case"water":b=k;break;case"motion":b=l}return a.peripheral&&a.peripheral.temp&&(d=" ("+a.peripheral.temp+"&deg;)"),c=b.split("{{SUB_DEVICE_ID}}").join(a.label.split(" ").join("+")),c=c.split("{{SUB_DEVICE_NAME}}").join(a.label+d),c=c.split("{{SUB_DEVICE_STATE}}").join("on"===a.state?" device-active":"")};if(d&&"object"==typeof d&&"string"==typeof d.mode){if(q=d.mode,f=d.devices)if(d.groups)for(n in d.groups){p+=m,r="";for(o in d.groups[n])g=t(d.groups[n][o],f),g&&g[0]&&(r+=u(g[0]));p=p.split("{{GROUP_TITLE}}").join(n),p=p.split("{{SUB_DEVICE_LIST}}").join(r)}else for(n in f)s=getTemplate(f[n]),tempDeviceMarkup+=u(f[n]);switch(q){case"Home":b=b.split("{{DEVICE_STATE_HOME}}").join(" device-active");break;case"Away":b=b.split("{{DEVICE_STATE_AWAY}}").join(" device-active");break;case"Night":b=b.split("{{DEVICE_STATE_NIGHT}}").join(" device-active")}}return b=b.split("{{DEVICE_STATE_HOME}}").join(""),b=b.split("{{DEVICE_STATE_AWAY}}").join(""),b=b.split("{{DEVICE_STATE_NIGHT}}").join(""),b.replace("{{SMARTTHINGS_DYNAMIC}}",p)}}("undefined"==typeof exports?this.Switchboard.parsers:exports),function(a){"use strict";a.stocks=function(a,b,c,d,e){var f=e.list,g=0,h="",i="",j="",k="";if("ok"===c?h=" device-on":"err"===c&&(h=" device-off"),b=b.replace("{{DEVICE_STATE}}",h),d)for(g in d)0===d[g].dayChangeValue.indexOf("+")?(j="gain",k='<span class="fa fa-arrow-up"><span>Gain</span></span>'):0===d[g].dayChangeValue.indexOf("-")?(j="loss",k='<span class="fa fa-arrow-down"><span>Loss</span></span>'):(j="neutral",k='<span class="fa fa-arrows-h"><span>Neutral</span></span>'),i+=f.split("{{STOCK_CHANGE}}").join(j),i=i.split("{{STOCK_ARROW}}").join(k),i=i.split("{{STOCK_NAME}}").join(d[g].name),i=i.split("{{STOCK_PRICE}}").join(d[g].price),i=i.split("{{STOCK_CHANGE_VALUE}}").join(d[g].dayChangeValue),i=i.split("{{STOCK_CHANGE_PERCENT}}").join(d[g].dayChangePercent);return b.replace("{{STOCKS_DYNAMIC}}",i)}}("undefined"==typeof exports?this.Switchboard.parsers:exports);