/* 20140901 */
Switchboard=function(){"use strict";return{version:20140829,state:{},parsers:{},templates:{},event:{list:[],add:function(a,b,c,d){d=d||!1,a.addEventListener?a.addEventListener(b,c,d):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c,Switchboard.event.list.push([a,b,c])},remove:function(a,b,c,d){d=d||!1;var e=0;for(a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null,e;e<Switchboard.event.list.length;e+=1)if(Switchboard.event.list[e]&&Switchboard.event.list[e]&&Switchboard.event.list[e][0]===a&&Switchboard.event.list[e][1]===b&&Switchboard.event.list[e][2]===c){Switchboard.event.list.splice(e,1);break}},removeAll:function(a){a=a||document;var b=Switchboard.event.list.length-1;for(b;b>=0;b-=1)Switchboard.event.list[b]&&(!Switchboard.event.list[b]||Switchboard.event.list[b][0]!==a&&a!==document||Switchboard.event.remove(Switchboard.event.list[b][0],Switchboard.event.list[b][1],Switchboard.event.list[b][2]))}},getTarget:function(a){return a=a||window.event,a.target?a.target:a.srcElement},hasAttribute:function(a,b,c){return a[b]?a[b].match(new RegExp("(\\s|^)"+c+"(\\s|$)"))?!0:!1:void 0},hasClass:function(a,b){return Switchboard.hasAttribute(a,"className",b)?!0:!1},addClass:function(a,b){Switchboard.hasClass(a,b)||(a.className=Switchboard.trim(a.className+" "+b))},removeClass:function(a,b){Switchboard.hasClass(a,b)&&(a.className=a.className.replace(new RegExp("(\\s|^)"+b+"(\\s|$)")," "),a.className=Switchboard.trim(a.className))},toggleClass:function(a,b){Switchboard.hasClass(a,b)?Switchboard.removeClass(a,b):Switchboard.addClass(a,b)},getElementsByClassName:function(a,b,c){var d=[],e=[],f=0,g=0;if(b=b||document,c=c.toLowerCase()||"*","*"===c&&document.getElementsByClassName)return b.getElementsByClassName(a);if(b.getElementsByClassName)if(e=b.getElementsByClassName(a),c&&e.length)for(f in e)e[f].tagName&&e[f].tagName.toLowerCase()===c&&(d[g]=e[f],g+=1);else d=e;else{e=b.getElementsByTagName(c);for(f in e)Switchboard.hasClass(e[f],a)&&(d[g]=e[f],g+=1)}return d},getText:function(a){return a.textContent?a.textContent:a.innerText?a.innerText:a.text?a.text:a.innerHTML},putText:function(a,b){a.textContent?a.textContent=b:a.innerText?a.innerText=b:a.text?a.text=b:a.innerHTML=b},trim:function(a){return a=a||"",a.toString().replace(/^\s\s*/,"").replace(/\s\s*$/,"")},decode:function(json){var reply="";return reply="object"==typeof JSON?JSON.parse(json):eval("("+json+")")},log:function(a){var b=new Date;"object"==typeof console&&"function"==typeof console.log&&console.log(a+" ("+b.getHours()+":"+(b.getMinutes()<10?"0":"")+b.getMinutes()+")")},ajax:{request:function(a){a.method=a.method||"GET",a.onStart=a.onStart||function(){},a.onComplete=a.onComplete||function(){};var b,c,d="?";if(c=function(){switch(a.onStart(),typeof a.onComplete){case"object":a.onComplete.value?a.onComplete.value=a.response:a.onComplete.childNodes[0]&&Switchboard.putText(a.onComplete,a.response);break;case"function":a.onComplete()}},window.XMLHttpRequest)b=new XMLHttpRequest;else{if(!window.ActiveXObject)return!1;b=new ActiveXObject("Microsoft.XMLHTTP")}"GET"===a.method&&((-1!==a.path.indexOf("?")||-1!==a.param.indexOf("?"))&&(d="&"),a.path=a.path+d+a.param,a.param=""),b.open(a.method.toUpperCase(),a.path,!0),"POST"===a.method&&b.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),b.setRequestHeader("rest","true"),Switchboard.event.add(b,"readystatechange",function(){if(4===b.readyState){if(200!==b.status)return!1;a.response=b.responseText,c()}}),b.send(a.param)}},init:function(){var a,b,c,d,e,f,g,h,i,j=document.getElementsByTagName("header")[0],k=document.getElementsByTagName("main")[0],l=(Switchboard.getElementsByClassName("text-form",k,"form"),j.dataset.stringConnected),m=j.dataset.stringConnecting,n=j.dataset.stringDisonnected;f=function(a){var b,d,e,f=document.getElementById(a.deviceId),g=Switchboard.parsers[a.typeClass],h=a.value,i=a.state,j=document.createElement("div");Switchboard.state[a.deviceId]=a,Switchboard.log(a.deviceId+" updated"),f&&(d=c[a.typeClass].markup,b=Switchboard.hasClass(f,"selected")?" selected":"",e=f.innerHTML,g&&(d=g(a.deviceId,d,i,h,c[a.typeClass].fragments)),"ok"===i&&Switchboard.hasClass(f,"device-off")?(Switchboard.removeClass(f,"device-off"),Switchboard.addClass(f,"device-on")):"err"===i&&Switchboard.hasClass(f,"device-on")&&(Switchboard.removeClass(f,"device-on"),Switchboard.addClass(f,"device-off")),f&&d&&a&&(d=d.split("{{DEVICE_ID}}").join(a.deviceId),d=d.split("{{DEVICE_TYPE}}").join(a.typeClass),d=d.split("{{DEVICE_SELECTED}}").join(b),d=d.split("{{DEVICE_STATE}}").join("ok"===a.state?" device-on":" device-off"),d=d.split("{{LAZY_LOAD_IMAGE}}").join(b?"src":"data-src")),d&&(j.innerHTML=d,j=j.getElementsByTagName("section")[0],j.innerHTML!==e&&(f.outerHTML=d)))},h=function(){var a=!0;return document.getElementById("indicator")||(g=document.createElement("span"),g.id="indicator",Switchboard.addClass(g,"connecting"),Switchboard.putText(g,m),j.appendChild(g),a=!1),a},d=function(){var d=h();Switchboard.log("Connecting to WebSocket"),i=new WebSocket("ws://"+window.location.host,"echo-protocol"),Switchboard.event.add(i,"open",function(){g.className="connected",Switchboard.putText(g,l),d&&(i.send("fetch state"),Switchboard.log("Reconnected to WebSocket"))}),Switchboard.event.add(i,"close",function(){g.className="disconnected",Switchboard.putText(g,n),Switchboard.log("Disconnected from WebSocket")}),Switchboard.event.add(i,"message",function(d){var e,g=Switchboard.decode(d.data),h={};if("string"==typeof g.title)"function"==typeof Notification&&(e=new Notification(g.title,g.options),setTimeout(function(){e.close()},1e4),Switchboard.event.add(e,"click",function(){var c,d,e;window.focus(),g.deviceId&&(c=document.getElementById(g.deviceId),d=Switchboard.getElementsByClassName("selected",j,"li")[0],e=Switchboard.getElementsByClassName("selected",k,"section")[0],Switchboard.removeClass(d,"selected"),Switchboard.removeClass(e,"selected"),a(g.deviceId),Switchboard.addClass(Switchboard.getElementsByClassName(g.deviceId,j,"li")[0],"selected"),Switchboard.addClass(c,"selected"),b(e))}));else if("string"==typeof g.deviceId)f(g);else if("object"==typeof g){for(h in g)break;if(g[h]&&g[h].deviceId){Switchboard.log("Received latest State");for(h in g)f(g[h])}else g[h]&&g[h].markup&&(c=g)}})},e=function(){var a=g&&Switchboard.hasClass(g,"connected");return a||d(),a},"function"==typeof WebSocket||"object"==typeof WebSocket?d():(Switchboard.log("WebSockets not supported - using polling"),h(),function(){var a;a={path:"/templates/",param:"ts="+(new Date).getTime(),method:"GET",onComplete:function(){c=Switchboard.decode(a.response)}},Switchboard.ajax.request(a),setInterval(function(){var a={path:"/state/",param:"ts="+(new Date).getTime(),method:"GET",onComplete:function(){var b,c=Switchboard.decode(a.response);if(c){g.className="connected",Switchboard.putText(g,l),setTimeout(function(){g.className="connecting",Switchboard.putText(g,m)},1e3);for(b in c)f(c[b])}else g.className="disconnected",Switchboard.putText(g,n)}};Switchboard.ajax.request(a)},1e4)}()),a=function(a){var b,c,d=0;if(document.getElementById(a))for(b=document.getElementById(a),c=b.getElementsByTagName("img"),d=0;d<c.length;d+=1)c[d].getAttribute("data-src")&&!c[d].src&&(c[d].src=c[d].getAttribute("data-src"))},b=function(a){var b,c=0;if(a)for(b=a.getElementsByTagName("img"),c=0;c<b.length;c+=1)b[c].getAttribute("src")&&Switchboard.hasClass(b[c],"streaming")&&(b[c].setAttribute("data-src",b[c].src),b[c].removeAttribute("src"))},a(document.body.className),Switchboard.event.add(j,"click",function(c){var e=Switchboard.getTarget(c).parentNode,f=e.tagName.toLowerCase(),g=document.getElementById(e.className),h=Switchboard.getElementsByClassName("selected",j,"li")[0],i=Switchboard.getElementsByClassName("selected",k,"section")[0];"li"===f?(c.preventDefault(),e!==h&&(Switchboard.removeClass(h,"selected"),Switchboard.removeClass(i,"selected"),a(e.className),Switchboard.addClass(e,"selected"),Switchboard.addClass(g,"selected"),b(i)),"function"==typeof Notification&&"denied"!==Notification.permission&&Notification.requestPermission(function(a){Notification.permission!==a&&(Notification.permission=a)})):"indicator"===Switchboard.getTarget(c).id&&Switchboard.hasClass(Switchboard.getTarget(c),"disconnected")&&d()}),Switchboard.event.add(k,"click",function(a){var b,c=Switchboard.getTarget(a),d=c.tagName.toLowerCase(),f="",g=(new Date).getTime();c="img"===d?c.parentNode:c,c="i"===d?c.parentNode:c,c="span"===d?c.parentNode:c,"a"===c.tagName.toLowerCase()&&"external"!=c.rel&&(a.preventDefault(),f=c.href,i?e()&&i.send(c.href):(b={path:f,param:"ts="+g,method:"GET",onComplete:function(){Switchboard.log(b.response)}},Switchboard.ajax.request(b)))}),Switchboard.event.add(k,"submit",function(a){var b,c,d=Switchboard.getTarget(a),f=((new Date).getTime(),""),g="";a.preventDefault(),f=Switchboard.getElementsByClassName("text-input",d,"input")[0].value,b=Switchboard.getElementsByClassName("text-input",d,"input")[0].name,g=Switchboard.getElementsByClassName("input-type",d,"input")[0].value,i?e()&&i.send("/?"+b+"="+g+"-"+f):(c={path:"/",param:b+"="+g+"-"+f,method:"POST",onComplete:function(){Switchboard.log(c.response)}},Switchboard.ajax.request(c))}),Switchboard.addClass(document.body,"rich"),"function"==typeof init&&init()}}}(),document.addEventListener&&document.addEventListener("DOMContentLoaded",Switchboard.init,!1),Switchboard.event.add(window,"load",function(){"use strict";document.addEventListener||Switchboard.init()}),Switchboard.event.add(window,"unload",function(){"use strict";Switchboard.event.removeAll()}),function(a){"use strict";a.foscam=function(a,b,c,d){var e,f,g="",h="";return"on"===d?g=" device-active":"off"===d&&(h=" device-active"),b=b.replace("{{DEVICE_STATE_ON}}",g),b=b.replace("{{DEVICE_STATE_OFF}}",h),"object"==typeof Switchboard&&(e=Switchboard.getElementsByClassName("fa-lock",document.getElementById(a),"a")[0],f=Switchboard.getElementsByClassName("fa-unlock",document.getElementById(a),"a")[0],"on"!==d||Switchboard.hasClass(e,"device-on")?"off"!==d||Switchboard.hasClass(f,"device-on")?b=b.split("{{LAZY_LOAD_IMAGE}}").join(Switchboard.hasClass(Switchboard.getElementsByClassName("selected",null,"li")[0],a)?"src":"data-src"):(Switchboard.addClass(f,"device-active"),Switchboard.removeClass(e,"device-active"),b=""):(Switchboard.addClass(e,"device-active"),Switchboard.removeClass(f,"device-active"),b="")),b}}("undefined"==typeof exports?this.Switchboard.parsers:exports),function(a){"use strict";a.nest=function(a,b,c,d,e,f){var g,h,i,j,k=e.thermostat,l=e.protect,m=e.group,n="",o="",p="",q={},r=function(a){var b;return"object"==typeof Switchboard?a=Switchboard.util.encodeName(a):(b=require(__dirname+"/../lib/sharedUtil").util,a=b.encodeName(a)),"group-"+a},s=function(a){var b;return"object"==typeof Switchboard?a=Switchboard.util.translate(a,"nest"):(b=require(__dirname+"/../lib/sharedUtil").util,a=b.translate(a,"nest",f)),a};if(d){for(g in d.thermostat){switch(q=d.thermostat[g],"object"==typeof Switchboard&&(j=Switchboard.getElementsByClassName(r(q.label),document.getElementById(a),"li")[0],h=Switchboard.getElementsByClassName("fa-sun-o",j,"a")[0],i=Switchboard.getElementsByClassName("fa-asterisk",j,"a")[0],"cool"!==q.state||Switchboard.hasClass(i,"device-active")?"heat"!==q.state||Switchboard.hasClass(h,"device-active")?"off"!==q.state||Switchboard.hasClass(j,"device-off")||(Switchboard.addClass(j,"device-off"),Switchboard.removeClass(i,"device-active"),Switchboard.removeClass(h,"device-active"),b=""):(Switchboard.addClass(h,"device-active"),Switchboard.removeClass(i,"device-active"),Switchboard.removeClass(j,"device-off"),b=""):(Switchboard.addClass(i,"device-active"),Switchboard.removeClass(h,"device-active"),Switchboard.removeClass(j,"device-off"),b="")),n+=k.split("{{SUB_DEVICE_ID}}").join(r(q.label)),n=n.split("{{SUB_DEVICE_NAME}}").join(q.label),n=n.split("{{SUB_DEVICE_TEMP}}").join(Math.round(q.temp)),n=n.split("{{SUB_DEVICE_TARGET}}").join(Math.round(q.target)),n=n.split("{{SUB_DEVICE_HUMIDITY}}").join(Math.round(q.humidity)),q.state){case"cool":n=n.split("{{DEVICE_STATE_COOL}}").join(" device-active");break;case"heat":n=n.split("{{DEVICE_STATE_HEAT}}").join(" device-active");break;default:n=n.split("{{DEVICE_STATE_OFF}}").join(" device-off")}q.leaf===!0&&(n=n.split("{{DEVICE_STATE_LEAF}}").join(" device-active")),n=d.presence&&"on"===d.presence?n.split("{{DEVICE_STATE_HOME}}").join(" device-active"):n.split("{{DEVICE_STATE_AWAY}}").join(" device-active"),n=n.split("{{DEVICE_STATE_COOL}}").join(""),n=n.split("{{DEVICE_STATE_HEAT}}").join(""),n=n.split("{{DEVICE_STATE_OFF}}").join(""),n=n.split("{{DEVICE_STATE_LEAF}}").join(""),n=n.split("{{DEVICE_STATE_HOME}}").join(""),n=n.split("{{DEVICE_STATE_AWAY}}").join("")}for(g in d.protect)p="",q=d.protect[g],"ok"!==q.smoke&&(p+="smoke "),"ok"!==q.co&&(p+="co "),"ok"!==q.battery&&(p+="batt "),p&&(p+="device-active"),o+=l.split("{{SUB_DEVICE_STATE}}").join(p),o=o.split("{{SUB_DEVICE_NAME}}").join(q.label),o=o.split("{{SUB_DEVICE_SMOKE}}").join(q.smoke),o=o.split("{{SUB_DEVICE_CO}}").join(q.co),o=o.split("{{SUB_DEVICE_BATT}}").join(q.battery);n&&(n=m.replace("{{SUB_DEVICE_LIST}}",n),n=n.replace("{{SUB_DEVICE_CLASS}}"," control-device-status"),n=n.replace("{{SUB_DEVICE_NAME}}",s("THERMOSTAT"))),o&&(o=m.replace("{{SUB_DEVICE_LIST}}",o),o=o.replace("{{SUB_DEVICE_CLASS}}"," text-device-status"),o=o.replace("{{SUB_DEVICE_NAME}}",s("PROTECT")))}return b=b.replace("{{NEST_DYNAMIC}}",n+o)}}("undefined"==typeof exports?this.Switchboard.parsers:exports),function(a){"use strict";a.roku=function(a,b,c,d,e){var f=e.list,g=0,h="";if(d)for(g in d)h+=f.split("{{APP_ID}}").join(d[g].id),h=h.split("{{APP_IMG}}").join(d[g].cache),h=h.split("{{APP_NAME}}").join(d[g].name);return b.replace("{{ROKU_DYNAMIC}}",h)}}("undefined"==typeof exports?this.Switchboard.parsers:exports),function(a){"use strict";a.smartthings=function(a,b,c,d,e){var f,g,h=e.switch,i=e.lock,j=e.contact,k=e.water,l=e.motion,m=e.presence,n=e.group,o=0,p=0,q="",r="",s="",t=function(a){var b;return"object"==typeof Switchboard?a=Switchboard.util.encodeName(a):(b=require(__dirname+"/../lib/sharedUtil").util,a=b.encodeName(a)),"group-"+a},u=function(a,b){var c={},d=[],e=0,f=0;for(e in b)c=b[e],c.label===a&&(d[f]=c,f+=1);return d},v=function(a){var b="",c="",d="";switch(a.type){case"switch":b=h;break;case"lock":b=i;break;case"contact":b=j;break;case"water":b=k;break;case"motion":b=l;break;case"presence":b=m}return a.peripheral&&a.peripheral.temp&&(d=" ("+a.peripheral.temp+"&deg;)"),c=b.split("{{SUB_DEVICE_ID}}").join(a.label.split(" ").join("+")),c=c.split("{{SUB_DEVICE_NAME}}").join(a.label+d),c=c.split("{{SUB_DEVICE_STATE}}").join("on"===a.state?" device-active":"")};if(d&&"object"==typeof d&&"string"==typeof d.mode){if(r=d.mode,f=d.devices)if(d.groups)for(o in d.groups){q+=n,s="";for(p in d.groups[o])g=u(d.groups[o][p],f),g&&g[0]&&(s+=v(g[0]));q=q.split("{{GROUP_CLASS}}").join(t(o)),q=q.split("{{GROUP_TITLE}}").join(o),q=q.split("{{SUB_DEVICE_LIST}}").join(s)}else for(o in f)q+=v(f[o]);switch(r){case"Home":b=b.split("{{DEVICE_STATE_HOME}}").join(" device-active");break;case"Away":b=b.split("{{DEVICE_STATE_AWAY}}").join(" device-active");break;case"Night":b=b.split("{{DEVICE_STATE_NIGHT}}").join(" device-active")}}return b=b.split("{{DEVICE_STATE_HOME}}").join(""),b=b.split("{{DEVICE_STATE_AWAY}}").join(""),b=b.split("{{DEVICE_STATE_NIGHT}}").join(""),b.replace("{{SMARTTHINGS_DYNAMIC}}",q)}}("undefined"==typeof exports?this.Switchboard.parsers:exports),function(a){"use strict";a.stocks=function(a,b,c,d,e,f){var g=e.list,h=0,i="",j="",k="",l="",m=function(a){var b;return"object"==typeof Switchboard?a=Switchboard.util.translate(a,"stocks"):(b=require(__dirname+"/../lib/sharedUtil").util,a=b.translate(a,"stocks",f)),a};if(d)for(h in d)0===d[h].dayChangeValue.indexOf("+")?(j="gain",k="arrow-up",l=m("GAIN")):0===d[h].dayChangeValue.indexOf("-")?(j="loss",k="arrow-down",l=m("LOSS")):(j="neutral",k="arrows-h",l=m("NEUTRAL")),i+=g.split("{{STOCK_CHANGE}}").join(j),i=i.split("{{STOCK_ARROW}}").join(k),i=i.split("{{STOCK_DIRECTION}}").join(l),i=i.split("{{STOCK_NAME}}").join(d[h].name),i=i.split("{{STOCK_PRICE}}").join(d[h].price),i=i.split("{{STOCK_CHANGE_VALUE}}").join(d[h].dayChangeValue),i=i.split("{{STOCK_CHANGE_PERCENT}}").join(d[h].dayChangePercent);return b.replace("{{STOCKS_DYNAMIC}}",i)}}("undefined"==typeof exports?this.Switchboard.parsers:exports),function(a){"use strict";a.travis=function(a,b,c,d,e){var f=e.build,g="",h="",i="",j=0;if(c&&d)for(j;j<d.length;j+=1)h="",i="","created"===d[j].state||"started"===d[j].state?h="cogs":"ok"===d[j].status?h="check":"err"===d[j].status&&(h="times"),d[j].duration&&(i=" ("+d[j].duration+"s)"),g+=f.split("{{TRAVIS_URL}}").join(d[j].url),g=g.split("{{TRAVIS_ICON}}").join(h),g=g.split("{{TRAVIS_STATE}}").join(d[j].status),g=g.split("{{TRAVIS_DURATION}}").join(i),g=g.split("{{TRAVIS_DESCRIPTION}}").join(d[j].label);return b=b.replace("{{TRAVIS_DYNAMIC}}",g)}}("undefined"==typeof exports?this.Switchboard.parsers:exports),function(a){"use strict";a.weather=function(a,b,c,d,e){var f,g=e.forecast,h=0,i="";if(f=function(a){var b="";return a=parseInt(a,10),b=2>=a?"warning":4>=a?"bolt":8>=a?"asterisk":12>=a?"tint":18>=a?"asterisk":22>=a?"fire":24>=a?"flag":25===a||35===a?"asterisk":30>=a?"cloud":31===a||33===a?"moon-o":32===a||34===a||36===a?"sun-o":39>=a?"bolt":40===a?"tint":43>=a?"asterisk":44===a?"cloud":45===a?"bolt":46===a?"asterisk":47===a?"bolt":"question"},d&&d.code){b=b.replace("{{WEATHER_ICON}}",f(d.code)),b=b.replace("{{WEATHER_CURRENT}}",d.city+" Current Weather: "+d.temp+"&deg; "+d.text);for(h in d.forecast)i+=g.split("{{WEATHER_ICON}}").join(f(d.forecast[h].code)),i=i.split("{{WEATHER_DAY}}").join(d.forecast[h].day+":"),i=i.split("{{WEATHER_TEXT}}").join(d.forecast[h].text),i=i.split("{{WEATHER_HIGH}}").join(d.forecast[h].high+"&deg;"),i=i.split("{{WEATHER_LOW}}").join(d.forecast[h].low+"&deg;")}else b=b.replace("{{WEATHER_CURRENT}}","Weather data unavailable"),i=d;return b.replace("{{WEATHER_DYNAMIC}}",i)}}("undefined"==typeof exports?this.Switchboard.parsers:exports),function(a){"use strict";a.util={version:20140901,encodeName:function(a){return a=a.split(" ").join("_"),a=a.split(">").join("_"),a=a.split("<").join("_"),a=a.split('"').join("_"),a=a.split("'").join("_"),a=a.split("!").join("_"),a=a.split("@").join("_"),a=a.split("#").join("_"),a=a.split("$").join("_"),a=a.split("%").join("_"),a=a.split("^").join("_"),a=a.split("&").join("_"),a=a.split("*").join("_"),a=a.split("(").join("_"),a=a.split(")").join("_"),a=a.split(",").join("_"),a=a.split(";").join("_"),a=a.split(".").join("_"),a=a.toLowerCase()},translate:function(a,b,c){var d;return"object"==typeof Switchboard?(c=document.documentElement.getAttribute("lang"),d=function(a,b){var c=Switchboard.getElementsByClassName(b,document.getElementsByTagName("main")[0],"section")[0];return a=a.replace("{{i18n_","").replace("}}",""),c.dataset["string"+a.charAt(0)+a.substr(1).toLowerCase()]}):d=require(__dirname+"/translate").translate,d("{{i18n_"+a+"}}",b,c)}}}("undefined"==typeof exports?this.Switchboard:exports);